<!doctype html>
<html lang="ko">
    <head>
        <meta charset = "utf-8">
        <title>googleLogin</title>
    </head>
    <body>
        <button id="googleLogin">login with google</button>

        <h3>로그인 결과</h3>
        <pre id="result"></pre>
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
            import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

            const firebaseConfig = {
                apiKey: "AIzaSyB8k0R1QAqmCpoakcmdFnClx3Cue64qW9I",
                authDomain: "reservationservice-66ad9.firebaseapp.com",
                projectId: "reservationservice-66ad9",
                storageBucket: "reservationservice-66ad9.firebasestorage.app",
                messagingSenderId: "480749323758",
                appId: "1:480749323758:web:b546c17c905a1a3b23baff",
                measurementId: "G-SBCZDHDMND"
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);

            const provider = new GoogleAuthProvider();
            const auth = getAuth();

            document.getElementById("googleLogin").addEventListener('click', async () => {
                try {
                    const result = await signInWithPopup(auth, provider)

                    const user = result.user;
                    const idToken = await user.getIdToken();

                    const response = await fetch("/auth/firebase/login", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({idToken})
                    })

                    console.log(response)
                    const data = await response.json()
                    
                    document.getElementById('result').textContent = JSON.stringify(data, null, 2)

                } catch(err) {
                    console.error(err)
                }
                
            })





        </script>
    </body>
</html>