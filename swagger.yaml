openapi: 3.0.3
info:
  title: Reservation Service API
  version: 1.0.0

servers:
  - url: http://localhost:3000

tags:
  - name: Auth
  - name: Users
  - name: Reservations
  - name: Reviews

paths:
  # ============================
  # Auth
  # ============================
  /auth/naver/login:
    get:
      tags: [Auth]
      summary: 네이버 로그인 링크 요청
      description: 네이버 OAuth 로그인을 위한 인증 URL을 생성하여 응답한다.
      responses:
        '200':
          description: 로그인 URL 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseLoginUrl'
              examples:
                default:
                  value:
                    success: true
                    data:
                      loginUrl: "https://nid.naver.com/oauth2.0/authorize?client_id=..."
                    message: null
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                default:
                  value:
                    success: false
                    error:
                      code: "INTERNAL_SERVER_ERROR"
                      message: "일시적인 오류가 발생했습니다."

  /auth/naver/callback:
    get:
      tags: [Auth]
      summary: 네이버 로그인 콜백
      description: 네이버에서 전달된 인가 코드를 받아 액세스 토큰 및 사용자 정보를 처리한다.
      parameters:
        - in: query
          name: code
          schema:
            type: string
          required: true
          description: 네이버 OAuth 인가 코드
        - in: query
          name: state
          schema:
            type: string
          required: false
          description: CSRF 방지를 위한 상태 값
      responses:
        '200':
          description: 로그인 처리 성공 (JWT 발급 또는 리다이렉트용 정보)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseAuthTokens'
        '400':
          description: 잘못된 요청(코드값 오류 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/naver:
    post:
      tags: [Auth]
      summary: 네이버 로그인 JWT 요청
      description: 클라이언트가 전달한 네이버 액세스 토큰을 검증하고, 서비스용 JWT를 발급한다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                accessToken:
                  type: string
                  description: 네이버 액세스 토큰
              required:
                - accessToken
      responses:
        '200':
          description: JWT 발급 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseAuthTokens'
              examples:
                default:
                  value:
                    success: true
                    data:
                      accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.r..."
                    message: null
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/firebase:
    post:
      tags: [Auth]
      summary: Firebase 기반 로그인 JWT 요청
      description: Firebase ID 토큰을 검증하고, 내부 서비스용 JWT를 발급한다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                idToken:
                  type: string
                  description: Firebase ID 토큰
              required:
                - idToken
      responses:
        '200':
          description: JWT 발급 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseAuthTokens'
        '401':
          description: 토큰 검증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: 토큰 갱신
      description: 만료가 임박한 액세스 토큰을 갱신한다. 일반적으로 헤더나 쿠키의 리프레시 토큰을 사용한다.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 토큰 갱신 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseAccessToken'
        '401':
          description: 리프레시 토큰이 없거나 유효하지 않음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags: [Auth]
      summary: 로그아웃
      description: 서버 측에서 리프레시 토큰을 만료/삭제하여 로그아웃 처리한다.
      security:
        - bearerAuth: []
      responses:
        '204':
          description: 로그아웃 성공 (콘텐츠 없음)
        '401':
          description: 인증되지 않은 사용자
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ============================
  # Users
  # ============================
  /users/me:
    get:
      tags: [Users]
      summary: 프로필 정보 확인
      description: 현재 로그인한 사용자의 프로필 정보를 조회한다.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 프로필 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUserProfile'
              examples:
                default:
                  value:
                    success: true
                    data:
                      id: 3
                      email: "user@example.com"
                      name: "홍길동"
                      phone: "010-1234-5678"
                      role: "CUSTOMER"
                      createdAt: "2025-01-01T12:00:00Z"
                      updatedAt: "2025-01-02T09:30:00Z"
                    message: null
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags: [Users]
      summary: 프로필 정보 수정
      description: 현재 로그인한 사용자의 프로필 정보를 수정한다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                phone:
                  type: string
              additionalProperties: false
      responses:
        '200':
          description: 프로필 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUserProfile'
        '400':
          description: 잘못된 입력값
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags: [Users]
      summary: 프로필 삭제 (Soft Delete)
      description: 현재 로그인한 사용자를 소프트 삭제 처리한다.
      security:
        - bearerAuth: []
      responses:
        '204':
          description: 삭제 성공
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/me/reviews:
    get:
      tags: [Users]
      summary: 내 리뷰 확인
      description: 현재 로그인한 사용자가 작성한 리뷰 목록을 조회한다.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: size
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: 리뷰 목록 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseReviewList'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/me/favorites:
    get:
      tags: [Users]
      summary: 관심가게 조회
      description: 현재 로그인한 사용자의 관심 가게(즐겨찾기) 목록을 조회한다.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: size
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: 관심 가게 목록 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseStoreSummaryList'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ============================
  # Reservations
  # ============================
  /reservations:
    get:
      tags: [Reservations]
      summary: 나의 예약 현황 조회
      description: 현재 로그인한 사용자의 예약 목록을 조회한다.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [PENDING, CONFIRMED, CANCELED]
          description: 예약 상태 필터
        - in: query
          name: date
          schema:
            type: string
            format: date
          description: 특정 날짜 기준 필터 (YYYY-MM-DD)
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: size
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: 예약 목록 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseReservationList'
              examples:
                default:
                  value:
                    success: true
                    data:
                      items:
                        - id: 1
                          storeId: 10
                          userId: 3
                          status: "CONFIRMED"
                          reservedAt: "2025-01-01T10:00:00Z"
                          memo: "창가 자리 부탁드립니다."
                          createdAt: "2024-12-30T08:00:00Z"
                          updatedAt: "2024-12-30T09:00:00Z"
                      totalCount: 1
                    message: null
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reservations/{id}:
    get:
      tags: [Reservations]
      summary: 예약 상세 조회
      description: 예약 ID로 예약 상세 정보를 조회한다.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 예약 상세 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseReservation'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 예약을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags: [Reservations]
      summary: 예약 수정 / 취소
      description: 예약 정보를 수정하거나 취소 상태로 변경한다.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reservedAt:
                  type: string
                  format: date-time
                status:
                  type: string
                  enum: [PENDING, CONFIRMED, CANCELED]
                memo:
                  type: string
              additionalProperties: false
      responses:
        '200':
          description: 예약 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseReservation'
        '400':
          description: 잘못된 입력값
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 예약을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reservations/{id}/status:
    patch:
      tags: [Reservations]
      summary: 예약 상태 변경
      description: 예약의 상태값만 별도로 변경한다.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [PENDING, CONFIRMED, CANCELED]
              required:
                - status
      responses:
        '200':
          description: 상태 변경 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseReservation'
        '400':
          description: 잘못된 상태값
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 예약을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reservations/{id}/review:
    post:
      tags: [Reservations]
      summary: 리뷰 추가
      description: 특정 예약에 대해 리뷰를 작성한다.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
                content:
                  type: string
              required:
                - rating
                - content
      responses:
        '201':
          description: 리뷰 작성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseReview'
        '400':
          description: 잘못된 입력값
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 예약을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ============================
  # Reviews
  # ============================
  /reviews/{id}:
    put:
      tags: [Reviews]
      summary: 리뷰 수정
      description: 기존에 작성된 리뷰 내용을 수정한다.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
                content:
                  type: string
              required:
                - rating
                - content
      responses:
        '200':
          description: 리뷰 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseReview'
        '400':
          description: 잘못된 입력값
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 리뷰를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags: [Reviews]
      summary: 리뷰 삭제 (Soft Delete)
      description: 리뷰를 소프트 삭제 처리한다.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: 삭제 성공
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 리뷰를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # ---------- 공통 응답 래퍼 ----------
    ApiResponseLoginUrl:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            loginUrl:
              type: string
        message:
          type: string
          nullable: true

    ApiResponseAuthTokens:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/AuthTokens'
        message:
          type: string
          nullable: true

    ApiResponseAccessToken:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            accessToken:
              type: string
        message:
          type: string
          nullable: true

    ApiResponseUserProfile:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/UserProfile'
        message:
          type: string
          nullable: true

    ApiResponseReservation:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Reservation'
        message:
          type: string
          nullable: true

    ApiResponseReservationList:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/Reservation'
            totalCount:
              type: integer
        message:
          type: string
          nullable: true

    ApiResponseReview:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Review'
        message:
          type: string
          nullable: true

    ApiResponseReviewList:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/Review'
            totalCount:
              type: integer
        message:
          type: string
          nullable: true

    ApiResponseStoreSummaryList:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/StoreSummary'
            totalCount:
              type: integer
        message:
          type: string
          nullable: true

    # ---------- 에러 응답 ----------
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: "UNAUTHORIZED"
            message:
              type: string
              example: "인증이 필요합니다."
            details:
              type: object
              nullable: true

    # ---------- 도메인 스키마 ----------
    AuthTokens:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string

    UserProfile:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        name:
          type: string
        phone:
          type: string
        role:
          type: string
          description: 사용자 권한
          example: "CUSTOMER"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    StoreSummary:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        type:
          type: string
        address:
          type: string
        phone:
          type: string

    Reservation:
      type: object
      properties:
        id:
          type: integer
        storeId:
          type: integer
        userId:
          type: integer
        status:
          type: string
          enum: [PENDING, CONFIRMED, CANCELED]
          description: 예약 상태
        reservedAt:
          type: string
          format: date-time
        memo:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Review:
      type: object
      properties:
        id:
          type: integer
        reservationId:
          type: integer
        userId:
          type: integer
        storeId:
          type: integer
        rating:
          type: integer
          minimum: 1
          maximum: 5
        content:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
